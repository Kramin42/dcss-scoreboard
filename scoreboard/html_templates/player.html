{% extends "base.html" %}
{% block title %}{{ player }}{% endblock %}
{% block content %}
<div class="row">
  <div class="col-sm-12">
    <h2>Stats for {{ player }}</h2>
    <hr>
  </div>
</div>
<div class="row">
  <div class="col-sm-4">
    <h3>Overall</h3>
    <p><strong>Last Active:</strong> {{ stats['last_active']|prettycrawldate }}</p>
    <p><strong>Games Played:</strong> {{ stats['games']|prettyint }}</p>
    <p><strong>Games Won:</strong> {{ stats['wins']|length }} ({{ (stats['winrate'] * 100)|round(2) }}%)</p>
    <p><strong>Quits:</strong> {{ stats['boring_games']|prettyint }} ({{ (stats['boring_rate'] * 100)|round(2) }}%)</p>
    <p><strong>Total Playtime:</strong> {{ stats['total_playtime']|prettydur }} hours</p>
    <p><strong>Total Score:</strong> {{ stats['total_score']|prettyint }}</p>
    <p><strong>Highest Score:</strong> {{ stats['highscore']['sc']|prettyint }}</p>
    <p><strong>Average Score:</strong> {{ (stats['avg_score']|round)|prettyint }}</p>
    {% if stats['wins']|length %}
      <p><strong>Fastest Win:</strong> {{ stats['fastest_realtime']['dur']|default(0)|prettydur }} hours</p>
      <p><strong>Shortest Win:</strong> {{ stats['fastest_turncount']['turn']|default(0)|prettyint }} turns</p>
      {% if streaks %}
      <p><strong>Longest Win Streak:</strong> {{ streaks[0].wins|length }} wins</p>
      {% endif %}
      {% if active_streak and active_streak.wins|length > 1 %}
        <p><strong>Active Win Streak ({{ active_streak.wins|length }}):</strong>
          {% for gid in active_streak.wins %}
          {{ gid|gidtogame|attr("char") }}
          {% endfor %}
        </p>
      {% endif %}
      {% if records['combo_highscores'] %}
      <h3>Global Highscores</h3>
        {% if records['race_highscores'] %}
          <p><strong>Species Highscores ({{ records['race_highscores']|length }}):</strong>
            {% for game in records['race_highscores'] %}
            {{ game|attr('rc') }}
            {% endfor %}
          </p>
        {% endif %}
        {% if records['role_highscores'] %}
          <p><strong>Background Highscores ({{ records['role_highscores']|length }}):</strong>
            {% for game in records['role_highscores'] %}
            {{ game|attr('bg') }}
            {% endfor %}
          </p>
        {% endif %}
        <p><strong>Combo Highscores Held ({{ records['combo_highscores']|length }}):</strong>
          {% for game in records['combo_highscores'] %}
          {{ game|attr('char') }}
          {% endfor %}
        </p>
      {% endif %}
    {% endif %}
  </div>
  <div class="col-sm-4">
    <h3>Wins</h3>
    <p><strong>Species Won ({{ stats['race_wins'].values()|reject("equalto", 0)|list|length }}/{{ const.PLAYABLE_RACES|length }}):</strong> {{ stats['race_wins']|prettycounter }}</p>
    <p><strong>Backgrounds Won ({{ stats['role_wins'].values()|reject("equalto", 0)|list|length }}/{{ const.PLAYABLE_ROLES|length }}):</strong> {{ stats['role_wins']|prettycounter }}</p>
    <p><strong>Gods Won ({{ stats['god_wins'].values()|reject("equalto", 0)|list|length }}/{{ const.PLAYABLE_GODS|length }}):</strong> {{ stats['god_wins']|prettycounter }}</p>
  </div>
  <div class="col-sm-4">
    <h3>Achievements</h3>
    {% for achievement in achievement_data %}
      {% if achievement['id'] in stats['achievements'].keys() %}
      <p>
        <h5 class="card-title">{{ achievement['name'] }}</h5>
        <p class="card-text">{{ achievement['description'] }}</p>
      </p>
      {% endif %}
    {% endfor %}
  </div>
</div>
<div class="row">
  <div class="col-sm-12">
    <!-- Nav tabs -->
    <ul class="nav nav-tabs" role="tablist">
      <li class="nav-item">
        <a class="nav-link active" data-toggle="tab" href="#games" role="tab">Recent Games</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" data-toggle="tab" href="#wins" role="tab">Recent Wins</a>
      </li>
    </ul>
    <!-- Tab panes -->
    <div class="tab-content">
      <div class="tab-pane active" id="games" role="tabpanel">
        <table class="{{ tableclasses }}">
          <thead>
            <tr>
              <th>Score</th>
              <th>Character</th>
              <th>God</th>
              <th>Place</th>
              <th>End</th>
              <th>XL</th>
              <th>Turns</th>
              <th>Duration</th>
              <th>Runes</th>
              <th>Date</th>
              <th>Version</th>
            </tr>
          </thead>
          <tbody>
            {% for game in recent_games %}
            {{ game|gametotablerow }}
            {% endfor %}
          </tbody>
        </table>
      </div>
      <div class="tab-pane" id="wins" role="tabpanel">
        <table class="{{ tableclasses }}">
          <thead>
            <tr>
              <th>Score</th>
              <th>Character</th>
              <th>God</th>
              <th>XL</th>
              <th>Turns</th>
              <th>Duration</th>
              <th>Runes</th>
              <th>Date</th>
              <th>Version</th>
            </tr>
          </thead>
          <tbody>
            {% for gid in stats['wins'][-5:]|reverse %}
            {{ gid|gidtogame|gametotablerow(winning_games=True) }}
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
{% endblock %}
