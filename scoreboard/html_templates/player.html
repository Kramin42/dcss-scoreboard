{% extends "base.html" %}
{% block title %}{{ player.name }}{% endblock %}
{% block content %}
<div class="row">
  <div class="col-sm-12">
    <h2>{{ player.name }}</h2>
    <hr>
  </div>
</div>
<div class="row">
  <div class="col-sm-3">
    <p><strong>Last Active:</strong> {{ games[0]|attr('end')|prettydate }}</p>
    <p><strong>Games Played:</strong> {{ games|length|prettyint }}</p>
    {% set wins = games|selectattr("won", "equalto", True)|list %}
    <p><strong>Wins:</strong> {{ wins|length }} ({{ (wins|length / games|length)|percentage }}%)</p>
    {% set quits = games|selectattr("quit", "equalto", True)|list %}
    <p><strong>Quits:</strong> {{ quits|length }} ({{  (quits|length / games|length)|percentage }}%)</p>
  </div>
  <div class="col-sm-3">
    <p><strong>Total Playtime:</strong> {{ games|map(attribute="dur")|sum|prettydur(hours=True) }} hours</p>
    {% set highest = games|highscore %}
    <p><strong>Highest Score:</strong> {{ highest|morgue_link(highest.score|prettyint + ' points') }}</p>
    {% if wins %}
      {% set shortest = games|shortest_win %}
      <p><strong>Shortest Win:</strong> {{ shortest|morgue_link(shortest.turn|prettyint + ' turns') }}</p>
      {% set fastest = games|fastest_win %}
      <p><strong>Fastest Win:</strong> {{ fastest|morgue_link(fastest.dur|prettydur + ' hours') }}</p>
    {% endif %}
  </div>
  <div class="col-sm-3">
    {% if streaks %}
        <p><strong>Longest Win Streak:</strong> {{ streaks[0].wins|length }} wins</p>
      {% if active_streak and active_streak.wins|length > 1 %}
        <p><strong>Active Win Streak:</strong> {{ active_streak.wins|length }} wins</p>
      {% endif %}
    {% endif %}
  </div>
</div>
<hr/>
<div class="row">
  <div class="col-sm-12">
    <h3>Recent Games</h3>
    {{ games[:10]|generic_games_to_table }}
  </div>
</div>
{# if player has a race/role highscore, they also have a combo highscore by definition #}
{% if records['combo'] or records['god'] %}
  <hr/>
  <div class="row">
    <div class="col-sm-12">
      <h3>Highscores</h3>
      {{ records|recordsformatted }}
    </div>
  </div>
{% endif %}
{% if streaks %}
  <hr/>
  <div class="row">
    <div class="col-sm-12">
      <h3>Win Streaks</h3>
      {{ streaks|streakstotable(show_player=False, limit=10) }}
    </div>
  </div>
{% endif %}
<hr/>
{% if all_wins|length %}
<div class="row">
  <div class="col-sm-12">
    <h3>Wins</h3>
    <div class="col-sm-4">
      <p><strong>By Species ({{ race_wins.values()|reject("equalto", 0)|list|length }}/{{ const.PLAYABLE_RACES|length }}):</strong></p>
      <p class="counter">{{ race_wins|prettycounter|safe }}</p>
    </div>
    <div class="col-sm-4">
      <p><strong>By Background ({{ background_wins.values()|reject("equalto", 0)|list|length }}/{{ const.PLAYABLE_ROLES|length }}):</strong></p>
      <p class="counter">{{ background_wins|prettycounter|safe }}</p>
    </div>
    <div class="col-sm-4">
      <p><strong>By God ({{ god_wins.values()|reject("equalto", 0)|list|length }}/{{ const.PLAYABLE_GODS|length }}):</strong></p>
      <p class="counter">{{ god_wins|prettycounter|safe }}</p>
    </div>
    {% if all_wins|length > 10 %}
      {{ all_wins[:10]|generic_highscores_to_table }}
      <div class="collapse" id="lessrecentwins">
        {{ all_wins[10:]|generic_highscores_to_table }}
      </div>
      <button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#lessrecentwins" aria-expanded="false" aria-controls="lessrecentwins">
        Show remaining {{ all_wins[10:]|length }} wins...
      </button>
    {% else %}
      {{ all_wins|generic_highscores_to_table }}
    {% endif %}
  </div>
</div>
{% endif %}
{% endblock %}
